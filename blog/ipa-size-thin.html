
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>iOS安装包瘦身指南 - 第七章</title>
  <meta name="author" content="第七章">

  
  <meta name="description" content="先看下Apple对安装包大小的限制： 资源优化 1.删除无用资源 解压ipa文件，检查是否有无用资源存在。 现在应该没有APP需要支持iPhone4以下的机型了，所以1X的图片可以全部删掉。3X的图片是保留还是删掉看具体情况。 重复的图片分两种，一种是名字一样的图片，如果你使用. &hellip;">
  <meta name="keywords" content="iOS 安装包瘦身 ipa bitcode">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kobe1941.github.io/blog/ipa-size-thin.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="第七章" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->


  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-60680038-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">第七章</a></h1>
  
    <h2>去年今日此门中，人面桃花相映红。人面不知何处去，桃花依旧笑春风。</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="kobe1941.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">首页</a></li>
  <li><a href="/blog/archives">文章列表</a></li>
  <li><a href="http://www.douban.com/people/47916859/">我的豆瓣</a></li>
  <li><a href="https://github.com/kobe1941">Github</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">iOS安装包瘦身指南</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2016-10-12T07:52:41+08:00'><span class='date'>2016 年10 月12 日</span> <span class='time'>7:52 am</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><p>先看下Apple对安装包大小的限制：</p>

<p><img src="/images/2016/10/12/1.png" alt="" /></p>

<!--more-->

<h2 id="section">资源优化</h2>

<h4 id="section-1">1.删除无用资源</h4>

<p>解压ipa文件，检查是否有无用资源存在。</p>

<p>现在应该没有APP需要支持iPhone4以下的机型了，所以1X的图片可以全部删掉。3X的图片是保留还是删掉看具体情况。</p>

<p>重复的图片分两种，一种是名字一样的图片，如果你使用.xcassets来管理图片，那么Xcode的左边栏会有警告提示图片名字重复，直接按提示一一处理即可。另一种是名字不一样但是文件一样的图片，我们使用了一个Python脚本（<a href="http://weibo.com/ganchaojiang?from=profile&amp;wvr=6&amp;is_hot=1">@甘超江</a> 大神出品）来扫描，每次编译的时候执行该脚本，如果有扫描命中则会让Xcode编译失败，此时需要人工去处理。需要注意的一点就是使用.xcassets来管理图片的时候回存在一个映射关系，通过imageNamed:方法使用的名字和图片的真实名字有可能不一样，脚本扫描的时候需要特别处理下。</p>

<p>未使用的图片可以通过<a href="http://www.jianshu.com/p/a72d03e92c80">LSUnusedResources</a>扫描出来，不过要注意的是可能会有误伤，该工具是全匹配，一些拼接名字来使用的图片要注意手动剔除。笔者就因为误删图片被惩罚过o(╯□╰)o</p>

<p>一些音频、视频和多余的plist文件以及readme文件什么的目测只能肉眼扫描了，我们没用到这些资源暂时没这个问题。</p>

<h4 id="section-2">2.资源压缩</h4>

<p>首先是图片压缩，ImageOptim工具可以实现无损压缩。</p>

<p>另外关于图片，建议使用Apple推荐的.xcassets来管理，它会把里边的所有png格式的图片压缩成一个Assets.car文件，压缩比率比其他方式管理图片要高。不过测试发现jpg图片不会在Assets.car文件里。</p>

<p>另如果你有用到音频或视频资源，也可以考虑压缩。</p>

<h4 id="h5">3.H5页面远端化</h4>

<p>如果你的H5有本地页面和资源，可以考虑全部远端化。本地资源主要是一些js、html文件和图片。</p>

<h2 id="section-3">编译选项优化</h2>

<p>这个最有用的一个选项是<code>Deployment Postprocessing</code>和<code>Strip Linked Product</code>，两个需要都设置为YES才有用。</p>

<p>原理是打开这两个选项后构建ipa会去除掉symbol符号，就是那些类名啊函数名啊啥的。这样子的影响就是运行时你没法进行线程回溯，符号都没了回溯了也是乱码。但是不会影响正常的崩溃日志生成和解析。在本机专门测试过，如果使用符号表来解析崩溃日志，则完全不受影响。</p>

<p>其他编译选项见下方的思维导图。</p>

<h2 id="section-4">可执行文件优化</h2>

<h4 id="section-5">1.未使用类的扫描</h4>

<p>原理直接参考<a href="http://www.cocoachina.com/ios/20151211/14562.html">微信的这篇文章</a>，主要是使用otool这个工具去取出可执行文件里的一些编译信息，可以拿到该可执行文件里所有的类和函数列表，以及使用过的类，两者相减就得到一个初步的未使用的类的列表，不过可能会有误伤，需要一一确认。</p>

<h4 id="section-6">2.功能重复的第三方库</h4>

<p>比如model层的mantle和realm，JsonKit和SBJson等功能类似的只需要一个就好，或者直接用系统自带的Json序列化工具。可以肉眼扫描也可以自己写脚本去扫描。如果使用了Cocoapods来管理第三方库的话，查询起来会更方便一些。</p>

<h4 id="section-7">3.空函数及默认实现的函数都可以删掉。</h4>

<p>有些函数只是实现了一个[super function],例如didReciveMemoryWarning，或者viewDidAppear如果没做额外的处理其实都是可以删除的。</p>

<h4 id="section-8">4.统计项目中各工程在可执行文件的大小占比</h4>

<p>可以在每个版本开发结束时统计一下各工程所占可执行文件的大小，这样可以看到size的趋势。</p>

<p>我写了个脚本可以用来统计每个工程静态库的大小和framework的大小，见<a href="https://github.com/kobe1941/shell">这里</a></p>

<p>效果图如下:</p>

<p><img src="/images/2016/10/12/2.png" alt="" /></p>

<p>不过要注意的是，此处的工程静态库指的是这个工程的整体产出，而不是引入的某个第三方的静态库：</p>

<p><img src="/images/2016/10/12/3.png" alt="" /></p>

<h2 id="section-9">其他</h2>

<p>重构以避免重复代码，以及未使用函数的扫描和删除都对减少ipa size有帮助，不过这两者不像上面提到的那些方法效果好，而且难度更大一些。尤其是重构，如果一开始设计的不好，可能一些重复的代码到处都是，比如屏幕宽高的宏，计算给定字符串高度的代码，给定宽高和颜色画一张图片等等这些代码都很可能被复制的很多份。</p>

<p>引入第三方库要慎重评估是否值得，有时候为了一个功能引入了一个很大的第三库，造成ipa size的显著增加，但是其实你只用到了其中一小部分功能，这个时候可以考虑自己实现其功能，而不是引入该库。</p>

<p>我们在实践中发现，技术上对于减少ipa大小最有用的主要是删掉未使用图片、去掉一些重复功能的第三方库以及编译选项去掉symbol符号。从产品角度砍掉部分鸡肋的功能效果却更明显，版本在迭代的过程中会有很多功能的尝试，功能收敛对ipa size的减少也很有帮助。</p>

<p>最后附上思维导图一张</p>

<p><img src="/images/2016/10/12/4.png" alt="" /></p>

<p>参考链接和拓展阅读</p>

<p>1.<a href="http://blog.cnbang.net/tech/2296/">iOS APP可执行文件的组成</a></p>

<p>2.<a href="http://blog.cnbang.net/tech/2544/">iOS 可执行文件瘦身方法</a></p>

<p>3.<a href="http://beyondvincent.com/2014/03/24/2014-03-20-reducing-the-size-of-my-app/">减少iOS应用程序的大小</a></p>

<p>4.<a href="https://zhuanlan.zhihu.com/p/19925959">你的iOS安装包真的“脱光”了么</a></p>
</div>


  <footer>
  <div align="center"><img src="/images/qrcode_pay.png" align="middle" width="300" height="300" alt="支付二维码" title="打赏作者" /></div>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
  (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-7430330121158143",
    enable_page_level_ads: true
  });
</script>
    <p class="meta"> 

      
  

<span class="byline author vcard">Posted by <span class="fn">第七章</span></span>

      




<time class='entry-date' datetime='2016-10-12T07:52:41+08:00'><span class='date'>2016 年10 月12 日</span> <span class='time'>7:52 am</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ioskai-fa/'>ios开发</a>
  
</span>


    </p>
    
      <!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="1265.21">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; min-height: 14.0px}
    span.s1 {text-decoration: underline ; color: #0000ee}
  </style>
</head>
<body>
<p class="p1">  </p>
</body>
<div class="bshare-custom"><a title="分享到新浪微博" class="bshare-sinaminiblog"></a><a title="分享到QQ空间" class="bshare-qzone"></a><a title="分享到人人网" class="bshare-renren"></a><a title="分享到腾讯微博" class="bshare-qqmb"></a><a title="分享到网易微博" class="bshare-neteasemb"></a><a title="更多平台" class="bshare-more bshare-more-icon more-style-addthis"></a><span class="BSHARE_COUNT bshare-share-count">0</span></div><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/buttonLite.js#style=-1&amp;uuid=&amp;pophcol=2&amp;lang=zh"></script><script type="text/javascript" charset="utf-8" src="http://static.bshare.cn/b/bshareC0.js"></script>
</html>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/hfrefresh.html" title="Previous Post: 下拉刷新框架HFRefresh介绍">&laquo; 下拉刷新框架HFRefresh介绍</a>
      
      
        <a class="basic-alignment right" href="/blog/alibaba-one-year.html" title="Next Post: 写在阿里一周年">写在阿里一周年 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/ioskai-fa/'>ios开发 (29)</a></li>
<li class='category'><a href='/blog/categories/ge-ren-zong-jie/'>个人总结 (6)</a></li>
<li class='category'><a href='/blog/categories/qi-ta/'>其他 (2)</a></li>
<li class='category'><a href='/blog/categories/du-shu-bi-ji/'>读书笔记 (37)</a></li>

  </ul>
</section>
<section>
  <h1>最新文章</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/peter-lynch-successful-investment.html">《彼得林奇的成功投资》</a>
      </li>
    
      <li class="post">
        <a href="/blog/compo.html">《涛动周期论》</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-intelligent-investor.html">《聪明的投资者》</a>
      </li>
    
      <li class="post">
        <a href="/blog/charles-munger.html">《穷查理宝典》</a>
      </li>
    
      <li class="post">
        <a href="/blog/invest-most-important-thing.html">《投资最重要的事》</a>
      </li>
    
  </ul>
</section>
<section>
    <h1>新浪微博</h1>
    <ul id="weibo">
    <li>

	<iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1247589445&verifier=42c93d86&dpc=1"></iframe>

      </li>
    </ul>
</section>




  
</aside>


<!--  -->

<div id="container"></div>
<link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
<script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
<script>
var gitment = new Gitment({
  // id: '<%= page.date %>', // document.location.href, // 可选。默认为 location.href
  // id: document.location.href,
  id: '2016-10-12 07:52:41 +0800',
  owner: 'kobe1941',
  repo: 'BlogComment',
  oauth: {
    client_id: '62a5e8671a334b627549',
    client_secret: 'b0832843f78bb177338384a045a24886cb577b9d',
  },
})
gitment.render('container')
</script>
    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2021 - 第七章 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?630713a9e9ac69afe7cd8376c786157b";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


</footer>
  






#




</body>
</html>

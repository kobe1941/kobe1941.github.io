
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>第七章</title>
  <meta name="author" content="第七章">

  
  <meta name="description" content="APP在运行过程中，如果内存占用过高则会引起以下几个问题： ①被操作系统的守护进程给杀掉，无论是前台还是后台； ②耗电增大，手机发热； ③系统可能会运行卡顿（不是换入换出到磁盘，而是解压缩和重压缩内存）； 业务背景 因为我们APP的直播间要玩网页版的小游戏，比较耗内存， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kobe1941.github.io/posts/2/index.html">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="第七章" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-60680038-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">第七章</a></h1>
  
    <h2>去年今日此门中，人面桃花相映红。人面不知何处去，桃花依旧笑春风。</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="kobe1941.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/memory.html">iOS APP内存优化记录</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-05-20T21:42:39+08:00'><span class='date'>2019 年5 月20 日</span> <span class='time'>9:42 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>APP在运行过程中，如果内存占用过高则会引起以下几个问题：</p>

<p>①被操作系统的守护进程给杀掉，无论是前台还是后台；</p>

<p>②耗电增大，手机发热；</p>

<p>③系统可能会运行卡顿（不是换入换出到磁盘，而是解压缩和重压缩内存）；</p>

<p>业务背景</p>

<p>因为我们APP的直播间要玩网页版的小游戏，比较耗内存，除了JS游戏本身降低内存消耗之外，native也需要释放更多的内存以提供给游戏使用，避免因为内存占用过大而被操作系统杀掉进程。</p>

<p>优化native本身的内存占用大体分为两部分：优化长期的内存占用和优化峰值内存占用。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/memory.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ios-level-up.html">iOS知识结构</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-05-12T18:06:44+08:00'><span class='date'>2019 年5 月12 日</span> <span class='time'>6:06 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>计算机三大知识结构：数据结构和算法，网络，操作系统。</p>

<p>这里陈硕在知乎上有个补充：<a href="https://www.zhihu.com/question/21405835">https://www.zhihu.com/question/21405835</a>，主要是谈到了计算机体系结构，这一块涉及到各个层面知识的串联和整合。</p>

<p>本文不会讲的很详细，只是简单罗列一些知识点及其应用场景，具体怎么做不会展开。</p>

<p>主要分几块的内容：iOS开发相关，计算机知识结构，软实力和职业规划。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/ios-level-up.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/crash-anr.html">崩溃和卡顿</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-05-12T13:20:17+08:00'><span class='date'>2019 年5 月12 日</span> <span class='time'>1:20 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文尝试分析和总结一下崩溃和主线程卡顿(ANR)的原理，以及对应的部分解决方案和案例。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/crash-anr.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ios-system-deep.html">《深入解析Mac OS X & iOS操作系统》</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-04-14T21:14:53+08:00'><span class='date'>2019 年4 月14 日</span> <span class='time'>9:14 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>整体上还算不错，对内核，Mach和BSD的介绍，包括一些函数和调用等，以及对异常处理的描述，对于理解PLC这个崩溃日志生成的库还是很有帮助的。同时一些内核线程、用户线程的概念也算是填补部分知识空白。引导过程虽然讲的很详细，不过兴趣不大。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/ios-system-deep.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/modern-operate-system.html">《现代操作系统》</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-02-11T22:17:58+08:00'><span class='date'>2019 年2 月11 日</span> <span class='time'>10:17 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>非常棒的一本书，可以把很多知识点给串起来，对于操作系统的历史发展和基本运行规则有比较清晰的描述。对非计算机科班的孩纸特别友好。个人认为第二章进程和线程，第三章存储管理，第六章死锁，第十章Linux实例研究都是非常值得读的章节，对实际理解操作系统也非常有用。当然如果涉及到视频，第七章的多媒体也不错。</p>

<p>存储管理这一章有一个小节介绍了很多种页面置换算法，在实际应用中，iOS很多第三方的框架有用到，比如YYCache用的LRU算法。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/modern-operate-system.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/plcrashreporter-2.html">PLCrashreporter源码分析其二</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-01-25T23:26:26+08:00'><span class='date'>2019 年1 月25 日</span> <span class='time'>11:26 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本篇文章主要对PLC内部用到的一些当时看源码时不太理解的底层函数进行分析，以及对一些为了理解PLC的原理需要了解的概念进行汇总。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/plcrashreporter-2.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/plcrashreporter-1.html">PLCrashreporter源码分析其一</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2019-01-19T22:53:32+08:00'><span class='date'>2019 年1 月19 日</span> <span class='time'>10:53 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>大概总共会分三篇文章来分析PLC，第一篇讲整体的工作流程，第二篇梳理PLC内部使用到的一些特殊函数的含义，第三篇会尝试做一个实践。</p>

<p>不定期更新，我想明白PLC的某个细节可能就会来更新一下。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/plcrashreporter-1.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/tencent-sports.html">腾讯体育iOS客户端逆向实践</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-11-11T19:40:58+08:00'><span class='date'>2018 年11 月11 日</span> <span class='time'>7:40 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h4 id="section">最终实现的结果：</h4>

<p>可以跳过闪屏+直播间广告，如果是免费的比赛，或者你是会员的话，可以提取直播间的超清直播URL（蓝光画质是服务器鉴权），该URL可以复制到手机Safari或者电脑端播放。</p>

<h4 id="section-1">实践总结：</h4>

<p>1.所有拉流直播链接都是服务器鉴权的，即使免费的比赛，你未登录时也会给你分配一个key；</p>

<p>2.一个普通非会员账号，是可以蹭几场会员才能看的比赛的，但是因为腾讯体育的服务器对同个账号的拉流有IP数量限制和流量限制，所以一般说来，除非是免费的比赛，否则不要把链接扩散给别人，另外就是蹭了几场比赛后，你的账号拿到的拉流URL，将只能试看1分钟，之后被断流。腾讯体育支持微信和QQ登录，你也可以准备多个账号用来救急某些重要比赛，当然还是买会员支持正版比较直接啦；</p>

<p>3.会员才能看的比赛，非会员也有一个方式可以看直播，清晰度一般但是勉强能看。<strong>还是买会员看蓝光画质美滋滋</strong>；</p>

<p>4.直播间获取直播链接的接口前缀为：<code>http://info.zb.video.qq.com/</code>，后面会拼接很多的参数，其中一个key跟用户账号绑定，服务器用这个来做ip打击和流量控制，抓包请认准该接口，返回数据为json格式，<strong>未做二次加密</strong>。在腾讯体育APP里，这个请求是用<code>NSURLConnection</code>这个类发出去的，要hook的话也要hook这个类的网络请求，而不是<code>NSURLSession</code>；</p>

<p>5.腾讯体育的直播拉流协议使用HLS，你用Charles抓包会看到ts文件不断的被下载下来播放。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/tencent-sports.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/ffextension.html">FFExtension</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-10-15T22:20:23+08:00'><span class='date'>2018 年10 月15 日</span> <span class='time'>10:20 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>写这个库的初衷是为了防止一些常见的崩溃，扫了一圈github上已有的库，都不太合适，像avoidCrash虽然能用，但是我不喜欢它用try-catch来做防崩溃的方式，它GitHub上的issue页也有很多问题是不好去定位和解决的。所以决定自己来是实现一遍。仓库的<a href="https://github.com/kobe1941/FFExtension">GitHub地址</a>，使用过程中遇到任何问题欢迎issue。</p>

<p>主要原理就是用Method Swizzle去hook系统类包括私有类的函数， 对常见的容器类，数组字典字符串这些有做保护，顺带新增了 NSSet，NSCache，NSUserDefaults，NSData ，NSAttributedString等几个类的保护，支持拦截 <code>unrecognized selector sent to instance</code> 异常，设置好要拦截的类即可。</p>

<p>一些使用代码规范就能解决的崩溃，比如 NSTimer，通知和 KVO 等等，本项目并未做额外处理，这种低级的失误，还是用代码规范来限制比较好。</p>

<p>已经在自己的项目用上了，目前工作稳定，iOS8.x 到 iOS12 都测试通过。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/ffextension.html">阅读全文</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/launch-time.html">iOS启动时间优化</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2018-07-22T15:49:44+08:00'><span class='date'>2018 年7 月22 日</span> <span class='time'>3:49 pm</span></time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2 id="section">背景</h2>

<p>一个项目做的时间长了，启动流程往往容易杂乱，库也用的越来越多，APP的启动时间也会慢慢变长。本次将针对iOS APP的启动时间优化一波。</p>

<p>通常针对一个技术点做优化的时候，都要先了解清楚这个技术点有哪些流程，优化的方向往往是减少流程的数量，以及减少每个流程的消耗。</p>

<p>本次优化从结果上来看，main阶段的优化效果最显著，尤其是启动时的一些IO操作处理，对启动时间的减少有很大作用。多线程启动的设计和验证最有意思，但是在实践上由于我们业务本身的原因，只开了额外一个子线程来并行启动，且仅在子线程做了少量的独立操作，这个要根据不同的业务去具体分析了。</p>

<p>一般说来，pre-main阶段的定义为APP开始启动到系统调用main函数这一段时间；main阶段则代表从main函数入口到主UI框架的viewDidAppear函数调用的这一段时间。（本文后续main阶段的时间统计都用<code>viewDidAppear</code>作为基准而非的<code>applicationWillFinishLaunching</code>）</p>

<p>本文前半部分讲原理（内容基本是从网上借鉴/摘录），后半部分讲实践，pre-main阶段的原理比较难理解，不过实践倒是根据结论直接做就好了。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/launch-time.html">阅读全文</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/3">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/index.html">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/ioskai-fa/'>ios开发 (29)</a></li>
<li class='category'><a href='/blog/categories/ge-ren-zong-jie/'>个人总结 (6)</a></li>
<li class='category'><a href='/blog/categories/qi-ta/'>其他 (2)</a></li>
<li class='category'><a href='/blog/categories/du-shu-bi-ji/'>读书笔记 (38)</a></li>

  </ul>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/great-stocker-memory.html">《股票大作手回忆录》</a>
      </li>
    
      <li class="post">
        <a href="/blog/peter-lynch-successful-investment.html">《彼得林奇的成功投资》</a>
      </li>
    
      <li class="post">
        <a href="/blog/compo.html">《涛动周期论》</a>
      </li>
    
      <li class="post">
        <a href="/blog/the-intelligent-investor.html">《聪明的投资者》</a>
      </li>
    
      <li class="post">
        <a href="/blog/charles-munger.html">《穷查理宝典》</a>
      </li>
    
  </ul>
</section>
<section>
    <h1>新浪微博</h1>
    <ul id="weibo">
    <li>

	<iframe width="100%" height="550" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=550&fansRow=1&ptype=1&speed=0&skin=1&isTitle=1&noborder=1&isWeibo=1&isFans=1&uid=1247589445&verifier=42c93d86&dpc=1"></iframe>

      </li>
    </ul>
</section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2023 - 第七章 -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
